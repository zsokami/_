name: test_pix2struct
on:
  workflow_dispatch:
jobs:
  test_clash_latency:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - uses: actions/setup-python@v4
      with:
        python-version: "3.10"
    - run: pip install "pix2struct[dev]@git+https://github.com/google-research/pix2struct" -f https://storage.googleapis.com/jax-releases/libtpu_releases.html
    - run: |
        python -m pix2struct.example_inference \
          --gin_search_paths="pix2struct/configs" \
          --gin_file=models/pix2struct.gin \
          --gin_file=runs/inference.gin \
          --gin_file=sizes/base.gin \
          --gin.MIXTURE_OR_TASK_NAME="'dummy_pix2struct'" \
          --gin.TASK_FEATURE_LENGTHS="{'inputs': 2048, 'targets': 128}" \
          --gin.BATCH_SIZE=1 \
          --gin.CHECKPOINT_PATH="'gs://pix2struct-data/textcaps_base/checkpoint_280400'" \
          --image=PTT7.png
